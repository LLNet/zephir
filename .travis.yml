dist: trusty

language: generic

git:
  depth: 1

cache:
  apt: true
  timeout: 604800
  directories:
    - $HOME/.cabal/packages

env:
  global:
    - CABALPKG=cabal-install
    - GHCPKG=ghc

  matrix:
    - CABALVER=1.16 GHCVER=7.6.1
    - CABALVER=1.24 GHCVER=8.0.1
    - CABALVER=2.4 GHCVER=8.6.3

before_install:
  - |
      # General settings
      set -e
      ulimit -c unlimited -S
      stty cols 120

      # Setting up cabal and ghc versions
      travis_retry sudo add-apt-repository -y ppa:hvr/ghc
      travis_retry sudo apt-get update

      export CABALPKG=cabal-install-$CABALVER
      export GHCPKG=ghc-$GHCVER
      export PATH=/opt/ghc/$GHCVER/bin:/opt/cabal/$CABALVER/bin:$PATH

install:
  - travis_retry sudo apt-get install $CABALPKG $GHCPKG
  - cabal --version
  - echo "$(ghc --version) [$(ghc --print-project-git-commit-id 2> /dev/null || echo '?')]"
  - travis_retry cabal update
  - cabal install --only-dependencies --enable-tests --enable-benchmarks

before_script:
  - cabal configure --enable-tests --enable-benchmarks -v2
  - cabal build

script:
  - dist/build/zephir/zephir

notifications:
  email: false
